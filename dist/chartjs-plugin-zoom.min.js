/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 0.6.6
 *
 * Copyright 2019 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],t):(e=e||self).ChartZoom=t(e.Chart,e.Hammer)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var o=e.helpers,n=e.Zoom=e.Zoom||{},a=n.zoomFunctions=n.zoomFunctions||{},i=n.panFunctions=n.panFunctions||{},l=n.defaults={pan:{enabled:!0,mode:"xy",speed:20,threshold:10},zoom:{enabled:!0,mode:"xy",sensitivity:3}};function r(e,t){return void 0===e||"string"==typeof e&&-1!==e.indexOf(t)}function m(e,t){if(e.scaleAxes&&e.rangeMax&&!o.isNullOrUndef(e.rangeMax[e.scaleAxes])){var n=e.rangeMax[e.scaleAxes];t>n&&(t=n)}return t}function s(e,t){if(e.scaleAxes&&e.rangeMin&&!o.isNullOrUndef(e.rangeMin[e.scaleAxes])){var n=e.rangeMin[e.scaleAxes];t<n&&(t=n)}return t}function u(e,t,o,n){var a=e.max-e.min,i=a*(t-1),l=e.isHorizontal()?o.x:o.y,r=(e.getValueForPixel(l)-e.min)/a,u=i*r,c=i*(1-r);e.options.ticks.min=s(n,e.min+u),e.options.ticks.max=m(n,e.max-c)}function c(e,t,o,n){var i=a[e.options.type];i&&i(e,t,o,n)}function d(e,t,n,a,i){var m=e.chartArea;a||(a={x:(m.left+m.right)/2,y:(m.top+m.bottom)/2});var s=e.options.zoom;if(s&&o.getValueOrDefault(s.enabled,l.zoom.enabled)){var u,d=o.getValueOrDefault(e.options.zoom.mode,l.zoom.mode);s.sensitivity=o.getValueOrDefault(e.options.zoom.sensitivity,l.zoom.sensitivity),u="xy"===d&&void 0!==i?i:"xy",o.each(e.scales,function(e){e.isHorizontal()&&r(d,"x")&&r(u,"x")?(s.scaleAxes="x",c(e,t,a,s)):!e.isHorizontal()&&r(d,"y")&&r(u,"y")&&(s.scaleAxes="y",c(e,n,a,s))}),e.update(0),"function"==typeof s.onZoom&&s.onZoom()}}function p(e,t,o){var n=e.options.ticks,a=e.start,i=e.end;n.reverse?(n.max=e.getValueForPixel(e.getPixelForValue(a)-t),n.min=e.getValueForPixel(e.getPixelForValue(i)-t)):(n.min=e.getValueForPixel(e.getPixelForValue(a)-t),n.max=e.getValueForPixel(e.getPixelForValue(i)-t)),n.min=s(o,n.min),n.max=m(o,n.max)}function f(e,t,o){var n=i[e.options.type];n&&n(e,t,o)}function v(e){for(var t=e.scales,o=Object.keys(t),n=0;n<o.length;n++){var a=t[o[n]];if(a.isHorizontal())return a}}function g(e){for(var t=e.scales,o=Object.keys(t),n=0;n<o.length;n++){var a=t[o[n]];if(!a.isHorizontal())return a}}n.zoomFunctions.category=function(e,t,o,a){var i=e.chart.data.labels,l=e.minIndex,r=i.length-1,u=e.maxIndex,c=a.sensitivity,d=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,p=e.isHorizontal()?o.x:o.y;n.zoomCumulativeDelta=t>1?n.zoomCumulativeDelta+1:n.zoomCumulativeDelta-1,Math.abs(n.zoomCumulativeDelta)>c&&(n.zoomCumulativeDelta<0?(p>=d?l<=0?u=Math.min(r,u+1):l=Math.max(0,l-1):p<d&&(u>=r?l=Math.max(0,l-1):u=Math.min(r,u+1)),n.zoomCumulativeDelta=0):n.zoomCumulativeDelta>0&&(p>=d?l=l<u?l=Math.min(u,l+1):l:p<d&&(u=u>l?u=Math.max(l,u-1):u),n.zoomCumulativeDelta=0),e.options.ticks.min=s(a,i[l]),e.options.ticks.max=m(a,i[u]))},n.zoomFunctions.time=function(e,t,o,n){var a,i,l=e.options;e.isHorizontal()?(a=e.right-e.left,i=(o.x-e.left)/a):(a=e.bottom-e.top,i=(o.y-e.top)/a);var r=a*(t-1),u=r*i,c=r*(1-i),d=e.getValueForPixel(e.getPixelForValue(e.min)+u),p=e.getValueForPixel(e.getPixelForValue(e.max)-c),f=p.diff(d),v=s(n,f)!==f,g=m(n,f)!==f;v||g||(l.time.min=d,l.time.max=p)},n.zoomFunctions.linear=u,n.zoomFunctions.logarithmic=u,n.panFunctions.category=function(e,t,o){var a,i=e.chart.data.labels,l=i.length-1,r=Math.max(e.ticks.length-(e.options.gridLines.offsetGridLines?0:1),1),u=o.speed,c=e.minIndex,d=Math.round(e.width/(r*u));n.panCumulativeDelta+=t,c=n.panCumulativeDelta>d?Math.max(0,c-1):n.panCumulativeDelta<-d?Math.min(l-r+1,c+1):c,n.panCumulativeDelta=c!==e.minIndex?0:n.panCumulativeDelta,a=Math.min(l,c+r-1),e.options.ticks.min=s(o,i[c]),e.options.ticks.max=m(o,i[a])},n.panFunctions.time=function(e,t,o){var n=e.options,a=m(o,e.getValueForPixel(e.getPixelForValue(e.max)-t)),i=s(o,e.getValueForPixel(e.getPixelForValue(e.min)-t)),l=t<0?a-e.max:i-e.min;n.time.max=e.max+l,n.time.min=e.min+l},n.panFunctions.linear=p,n.panFunctions.logarithmic=p,n.panCumulativeDelta=0,n.zoomCumulativeDelta=0;var x={id:"zoom",afterInit:function(e){o.each(e.scales,function(e){e.originalOptions=o.clone(e.options)}),e.resetZoom=function(){o.each(e.scales,function(e){var t=e.options.time,o=e.options.ticks;t&&(t.min=e.originalOptions.time.min,t.max=e.originalOptions.time.max),o&&(o.min=e.originalOptions.ticks.min,o.max=e.originalOptions.ticks.max)}),o.each(e.data.datasets,function(e){e._meta=null}),e.update()}},beforeInit:function(e){e.zoom={};var a=e.zoom.node=e.chart.ctx.canvas,i=e.options,m=o.getValueOrDefault(i.pan?i.pan.threshold:void 0,n.defaults.pan.threshold);if(i.zoom&&i.zoom.enabled&&(i.zoom.drag?(e.zoom._mouseDownHandler=function(t){e.zoom._dragZoomStart=t},a.addEventListener("mousedown",e.zoom._mouseDownHandler),e.zoom._mouseMoveHandler=function(t){e.zoom._dragZoomStart&&(e.zoom._dragZoomEnd=t,e.update(0))},a.addEventListener("mousemove",e.zoom._mouseMoveHandler),e.zoom._mouseUpHandler=function(t){if(e.zoom._dragZoomStart){var o=e.chartArea,n=v(e),a=g(e),l=e.zoom._dragZoomStart,m=n.left,s=n.right,u=a.top,c=a.bottom;if(r(i.zoom.mode,"x")){var p=l.target.getBoundingClientRect().left;m=Math.min(l.clientX,t.clientX)-p,s=Math.max(l.clientX,t.clientX)-p}if(r(i.zoom.mode,"y")){var f=l.target.getBoundingClientRect().top;u=Math.min(l.clientY,t.clientY)-f,c=Math.max(l.clientY,t.clientY)-f}var x=s-m,h=o.right-o.left,z=1+(h-x)/h,y=c-u,D=o.bottom-o.top,M=1+(D-y)/D;e.zoom._dragZoomStart=null,e.zoom._dragZoomEnd=null,(x>0||y>0)&&d(e,z,M,{x:x/2+m,y:y/2+u})}},a.ownerDocument.addEventListener("mouseup",e.zoom._mouseUpHandler)):(e.zoom._wheelHandler=function(t){var o=t.target.getBoundingClientRect(),n={x:t.clientX-o.left,y:t.clientY-o.top};t.deltaY<0?d(e,1.1,1.1,n):d(e,.909,.909,n),t.preventDefault()},a.addEventListener("wheel",e.zoom._wheelHandler)),t)){var s,u=new t.Manager(a);u.add(new t.Pinch),u.add(new t.Pan({threshold:m}));var c=function(t){var o=1/s*t.scale,n=t.target.getBoundingClientRect(),a={x:t.center.x-n.left,y:t.center.y-n.top},i=Math.abs(t.pointers[0].clientX-t.pointers[1].clientX),l=Math.abs(t.pointers[0].clientY-t.pointers[1].clientY),r=i/l;d(e,o,a,r>.3&&r<1.7?"xy":i>l?"x":"y"),s=t.scale};u.on("pinchstart",function(){s=1}),u.on("pinch",c),u.on("pinchend",function(e){c(e),s=null,n.zoomCumulativeDelta=0});var p=null,x=null,h=!1,z=function(t){if(null!==p&&null!==x){h=!0;var n=t.deltaX-p,a=t.deltaY-x;p=t.deltaX,x=t.deltaY,function(e,t,n){var a=e.options.pan;if(a&&o.getValueOrDefault(a.enabled,l.pan.enabled)){var i=o.getValueOrDefault(e.options.pan.mode,l.pan.mode);a.speed=o.getValueOrDefault(e.options.pan.speed,l.pan.speed),o.each(e.scales,function(e){e.isHorizontal()&&r(i,"x")&&0!==t?(a.scaleAxes="x",f(e,t,a)):!e.isHorizontal()&&r(i,"y")&&0!==n&&(a.scaleAxes="y",f(e,n,a))}),e.update(0),"function"==typeof a.onPan&&a.onPan()}}(e,n,a)}};u.on("panstart",function(e){p=0,x=0,z(e)}),u.on("panmove",z),u.on("panend",function(){p=null,x=null,n.panCumulativeDelta=0,setTimeout(function(){h=!1},500)}),e.zoom._ghostClickHandler=function(e){h&&(e.stopImmediatePropagation(),e.preventDefault())},a.addEventListener("click",e.zoom._ghostClickHandler),e._mc=u}},beforeDatasetsDraw:function(e){var t=e.chart.ctx,o=e.chartArea;if(t.save(),t.beginPath(),e.zoom._dragZoomEnd){var n=v(e),a=g(e),i=e.zoom._dragZoomStart,l=e.zoom._dragZoomEnd,m=n.left,s=n.right,u=a.top,c=a.bottom;if(r(e.options.zoom.mode,"x")){var d=i.target.getBoundingClientRect().left;m=Math.min(i.clientX,l.clientX)-d,s=Math.max(i.clientX,l.clientX)-d}if(r(e.options.zoom.mode,"y")){var p=i.target.getBoundingClientRect().top;u=Math.min(i.clientY,l.clientY)-p,c=Math.max(i.clientY,l.clientY)-p}var f=s-m,x=c-u,h=e.options.zoom.drag;t.fillStyle=h.backgroundColor||"rgba(225,225,225,0.3)",t.fillRect(m,u,f,x),h.borderWidth>0&&(t.lineWidth=h.borderWidth,t.strokeStyle=h.borderColor||"rgba(225,225,225)",t.strokeRect(m,u,f,x))}t.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),t.clip()},afterDatasetsDraw:function(e){e.chart.ctx.restore()},destroy:function(e){if(e.zoom){var o=e.options,n=e.zoom.node;o.zoom&&o.zoom.drag?(n.removeEventListener("mousedown",e.zoom._mouseDownHandler),n.removeEventListener("mousemove",e.zoom._mouseMoveHandler),n.ownerDocument.removeEventListener("mouseup",e.zoom._mouseUpHandler)):n.removeEventListener("wheel",e.zoom._wheelHandler),t&&n.removeEventListener("click",e.zoom._ghostClickHandler),delete e.zoom;var a=e._mc;a&&(a.remove("pinchstart"),a.remove("pinch"),a.remove("pinchend"),a.remove("panstart"),a.remove("pan"),a.remove("panend"))}}};return e.pluginService.register(x),x});
